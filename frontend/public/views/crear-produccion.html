<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crear Producción - SGAL</title>
    <link rel="stylesheet" href="../css/pages/produccion.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="main-content">
        <div class="form form--height">
            <a href="#" class="form__back-link button--back">
                <i class="fas fa-arrow-left"></i> Volver
            </a>
            <h1 class="form__title">Crear Producción</h1>

            <form id="productionForm" class="form__container">
                <!-- Primera fila: ID y Responsable -->
                <div class="form__row">
                    <div class="form__group">
                        <label for="productionId" class="form__label">Identificador de producción</label>
                        <input type="text" id="productionId" class="form__input form__input--disabled" disabled>
                    </div>
                    <div class="form__group">
                        <label for="responsible" class="form__label">Responsable</label>
                        <div class="select-group">
                            <select id="responsible" class="select-group__select form__select">
                                <option value="">Seleccionar responsable</option>
                                <option value="1">Juan Pérez</option>
                                <option value="2">María López</option>
                                <option value="3">Carlos Rodríguez</option>
                            </select>
                            <button type="button" class="select-group__button" id="addResponsibleBtn">
                                <i class="select-group__icon fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Segunda fila: Nombre de producción -->
                <div class="form__row">
                    <div class="form__group form__group--full-width">
                        <label for="productionName" class="form__label">Nombre de producción</label>
                        <input type="text" id="productionName" class="form__input" placeholder="Ingrese el nombre de la producción">
                        <small id="productionNameError" class="error hidden"></small>
                    </div>
                </div>

                <!-- Tercera fila: Cultivo y Ciclo de cultivo -->
                <div class="form__row">
                    <div class="form__group">
                        <label for="crop" class="form__label">Cultivo</label>
                        <div class="select-with-button">
                            <select id="crop" class="form__select">
                                <option value="">Seleccionar cultivo</option>
                                <option value="1">Maíz</option>
                                <option value="2">Frijol</option>
                                <option value="3">Tomate</option>
                            </select>
                            <button type="button" class="button--add" id="addCropBtn">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="form__group">
                        <label for="cropCycle" class="form__label">Ciclo de cultivo</label>
                        <div class="select-with-button">
                            <select id="cropCycle" class="form__select">
                                <option value="">Seleccionar ciclo</option>
                                <option value="1">Primavera-Verano</option>
                                <option value="2">Otoño-Invierno</option>
                                <option value="3">Anual</option>
                            </select>
                            <button type="button" class="button--add" id="addCycleBtn">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Cuarta fila: Sensores -->
                <div class="form__row">
                    <div class="form__group form__group--full-width">
                        <label for="sensors" class="form__label">Sensores (máximo 3)</label>
                        <div class="select-with-button">
                            <select id="sensors" class="form__select" multiple size="4">
                                <option value="1">Sensor de humedad</option>
                                <option value="2">Sensor de temperatura</option>
                                <option value="3">Sensor de pH</option>
                                <option value="4">Sensor de luz</option>
                                <option value="5">Sensor de CO2</option>
                            </select>
                            <button type="button" class="button--add" id="addSensorBtn">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <small id="sensorsError" class="error hidden"></small>
                    </div>
                </div>

                <!-- Visualización de lecturas de sensores -->
                <div class="production-readings">
                    <h3 class="production-readings__title">Visualización de lecturas de sensores</h3>
                    <div class="production-readings__charts" id="sensorCharts">
                        <div style="height: 200px; width: 100%;">
                            <canvas id="sensorChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Quinta fila: Insumos -->
                <div class="form__row">
                    <div class="form__group form__group--full-width">
                        <label for="supplies" class="form__label">Insumos</label>
                        <div class="select-with-button">
                            <select id="supplies" class="form__select" multiple size="4">
                                <option value="1">Fertilizante NPK</option>
                                <option value="2">Semillas certificadas</option>
                                <option value="3">Insecticida orgánico</option>
                                <option value="4">Fungicida</option>
                                <option value="5">Herbicida</option>
                            </select>
                            <button type="button" class="button--add" id="addSupplyBtn">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Tabla de insumos utilizados -->
                <div class="production-supplies">
                    <h3 class="production-supplies__title">Insumos utilizados</h3>
                    <table class="production-supplies__table" id="suppliesTable">
                        <thead>
                            <tr>
                                <th class="production-supplies__cell production-supplies__header">Insumo</th>
                                <th class="production-supplies__cell production-supplies__header">Fecha de uso</th>
                                <th class="production-supplies__cell production-supplies__header">Cantidad</th>
                                <th class="production-supplies__cell production-supplies__header">Responsable</th>
                                <th class="production-supplies__cell production-supplies__header">Valor unitario</th>
                                <th class="production-supplies__cell production-supplies__header">Valor total</th>
                                <th class="production-supplies__cell production-supplies__header">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="suppliesTableBody">
                            <!-- Las filas se agregarán dinámicamente -->
                        </tbody>
                    </table>
                    <button type="button" class="production-supplies__button" id="addSupplyRowBtn">
                        <i class="fas fa-plus"></i> Agregar insumo
                    </button>
                </div>

                <!-- Sexta fila: Inversión y Meta -->
                <div class="form__row">
                    <div class="form__group">
                        <label for="investment" class="form__label">Inversión</label>
                        <input type="text" id="investment" class="form__input form__input--disabled" disabled>
                    </div>
                    <div class="form__group">
                        <label for="goal" class="form__label">Meta (Estimación de ganancias)</label>
                        <input type="text" id="goal" class="form__input form__input--disabled" disabled>
                    </div>
                </div>

                <!-- Séptima fila: Fechas -->
                <div class="form__row">
                    <div class="form__group">
                        <label for="startDate" class="form__label">Fecha de inicio</label>
                        <input type="date" id="startDate" class="form__input">
                    </div>
                    <div class="form__group">
                        <label for="endDate" class="form__label">Fecha de fin (estimada)</label>
                        <input type="date" id="endDate" class="form__input">
                        <small id="dateError" class="error hidden"></small>
                    </div>
                </div>

                <!-- Botones de acción -->
                <div class="form__button-container">
                    <button type="button" class="button--secondary" id="saveDraftBtn">Guardar borrador</button>
                    <button type="submit" class="button--submit" id="createBtn" disabled>Crear</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para agregar responsable -->
    <div id="responsibleModal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Agregar Responsable</h2>
            <form id="responsibleForm">
                <div class="form__group">
                    <label for="newResponsibleName" class="form__label">Nombre completo</label>
                    <input type="text" id="newResponsibleName" class="form__input" required>
                </div>
                <div class="form__group">
                    <label for="newResponsibleEmail" class="form__label">Correo electrónico</label>
                    <input type="email" id="newResponsibleEmail" class="form__input" required>
                </div>
                <div class="form__button-container">
                    <button type="submit" class="button--submit">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para agregar cultivo -->
    <div id="cropModal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Agregar Cultivo</h2>
            <form id="cropForm">
                <div class="form__group">
                    <label for="newCropName" class="form__label">Nombre del cultivo</label>
                    <input type="text" id="newCropName" class="form__input" required>
                </div>
                <div class="form__group">
                    <label for="newCropDescription" class="form__label">Descripción</label>
                    <textarea id="newCropDescription" class="form__textarea"></textarea>
                </div>
                <div class="form__button-container">
                    <button type="submit" class="button--submit">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para agregar ciclo de cultivo -->
    <div id="cycleModal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Agregar Ciclo de Cultivo</h2>
            <form id="cycleForm">
                <div class="form__group">
                    <label for="newCycleName" class="form__label">Nombre del ciclo</label>
                    <input type="text" id="newCycleName" class="form__input" required>
                </div>
                <div class="form__group">
                    <label for="newCycleDuration" class="form__label">Duración (días)</label>
                    <input type="number" id="newCycleDuration" class="form__input" required min="1">
                </div>
                <div class="form__button-container">
                    <button type="submit" class="button--submit">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para agregar sensor -->
    <div id="sensorModal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Agregar Sensor</h2>
            <form id="sensorForm">
                <div class="form__group">
                    <label for="newSensorName" class="form__label">Nombre del sensor</label>
                    <input type="text" id="newSensorName" class="form__input" required>
                </div>
                <div class="form__group">
                    <label for="newSensorType" class="form__label">Tipo de sensor</label>
                    <select id="newSensorType" class="form__select" required>
                        <option value="">Seleccionar tipo</option>
                        <option value="temperatura">Temperatura</option>
                        <option value="humedad">Humedad</option>
                        <option value="ph">pH</option>
                        <option value="luz">Luz</option>
                        <option value="co2">CO2</option>
                    </select>
                </div>
                <div class="form__group">
                    <label for="newSensorUnit" class="form__label">Unidad de medida</label>
                    <input type="text" id="newSensorUnit" class="form__input" required>
                </div>
                <div class="form__button-container">
                    <button type="submit" class="button--submit">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para agregar insumo -->
    <div id="supplyModal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Agregar Insumo</h2>
            <form id="supplyForm">
                <div class="form__group">
                    <label for="newSupplyName" class="form__label">Nombre del insumo</label>
                    <input type="text" id="newSupplyName" class="form__input" required>
                </div>
                <div class="form__group">
                    <label for="newSupplyType" class="form__label">Tipo de insumo</label>
                    <select id="newSupplyType" class="form__select" required>
                        <option value="">Seleccionar tipo</option>
                        <option value="fertilizante">Fertilizante</option>
                        <option value="semilla">Semilla</option>
                        <option value="pesticida">Pesticida</option>
                        <option value="herbicida">Herbicida</option>
                        <option value="otro">Otro</option>
                    </select>
                </div>
                <div class="form__group">
                    <label for="newSupplyUnit" class="form__label">Unidad de medida</label>
                    <select id="newSupplyUnit" class="form__select" required>
                        <option value="">Seleccionar unidad</option>
                        <option value="kg">Kilogramo (kg)</option>
                        <option value="g">Gramo (g)</option>
                        <option value="l">Litro (l)</option>
                        <option value="ml">Mililitro (ml)</option>
                        <option value="unidad">Unidad</option>
                    </select>
                </div>
                <div class="form__group">
                    <label for="newSupplyPrice" class="form__label">Precio unitario</label>
                    <input type="number" id="newSupplyPrice" class="form__input" required min="0" step="0.01">
                </div>
                <div class="form__button-container">
                    <button type="submit" class="button--submit">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para agregar fila de insumo -->
    <div id="supplyRowModal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Agregar Uso de Insumo</h2>
            <form id="supplyRowForm">
                <div class="form__group">
                    <label for="supplySelect" class="form__label">Insumo</label>
                    <select id="supplySelect" class="form__select" required>
                        <option value="">Seleccionar insumo</option>
                        <!-- Se llenará dinámicamente -->
                    </select>
                </div>
                <div class="form__group">
                    <label for="supplyDate" class="form__label">Fecha de uso</label>
                    <input type="date" id="supplyDate" class="form__input" required>
                </div>
                <div class="form__group">
                    <label for="supplyQuantity" class="form__label">Cantidad</label>
                    <input type="number" id="supplyQuantity" class="form__input" required min="0.01" step="0.01">
                </div>
                <div class="form__group">
                    <label for="supplyResponsible" class="form__label">Responsable</label>
                    <select id="supplyResponsible" class="form__select" required>
                        <option value="">Seleccionar responsable</option>
                        <!-- Se llenará dinámicamente -->
                    </select>
                </div>
                <div class="form__group">
                    <label for="supplyUnitValue" class="form__label">Valor unitario</label>
                    <input type="number" id="supplyUnitValue" class="form__input" required min="0" step="0.01">
                </div>
                <div class="form__group">
                    <label for="supplyTotalValue" class="form__label">Valor total</label>
                    <input type="text" id="supplyTotalValue" class="form__input" readonly>
                </div>
                <div class="form__group">
                    <label for="supplyObservations" class="form__label">Observaciones</label>
                    <textarea id="supplyObservations" class="form__textarea"></textarea>
                </div>
                <div class="form__button-container">
                    <button type="submit" class="button--submit">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast para notificaciones -->
    <div id="toast" class="toast hidden">
        <div class="toast-content">
            <i id="toastIcon" class="fas fa-check-circle"></i>
            <div class="toast-message">
                <span id="toastTitle" class="toast-title">Éxito</span>
                <span id="toastDescription" class="toast-description">Operación completada con éxito</span>
            </div>
        </div>
        <div class="toast-progress"></div>
    </div>

    <style>
        /* Estilos adicionales para modales */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal.hidden {
            display: none;
        }

        .modal:not(.hidden) {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: var(--white);
            margin: auto;
            padding: 2.5rem;
            border-radius: 8px;
            width: 90%;
            max-width: 50rem;
            position: relative;
            animation: modalFadeIn 0.3s;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .close-modal {
            position: absolute;
            right: 2rem;
            top: 1.5rem;
            color: var(--gray-60);
            font-size: 2.4rem;
            font-weight: bold;
            cursor: pointer;
        }

        .close-modal:hover {
            color: var(--gray-100);
        }

        .hidden {
            display: none !important;
        }
    </style>
    <script src="../js/validations/production-validator.js"></script>
</body>
</html>